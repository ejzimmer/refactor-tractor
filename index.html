<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />

    <title>Getting on the Refactor Tractor</title>

    <link rel="stylesheet" href="css/reset.css" />
    <link rel="stylesheet" href="css/reveal.css" />
    <link rel="stylesheet" href="css/theme/moon.css" />

    <!-- Theme used for syntax highlighting of code -->
    <link rel="stylesheet" href="lib/css/monokai.css" />
    <link rel="stylesheet" href="css/fonts.css" />

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Eagle+Lake&display=swap"
      rel="stylesheet"
    />

    <!-- Printing and PDF exports -->
    <script>
      var link = document.createElement("link")
      link.rel = "stylesheet"
      link.type = "text/css"
      link.href = window.location.search.match(/print-pdf/gi)
        ? "css/print/pdf.css"
        : "css/print/paper.css"
      document.getElementsByTagName("head")[0].appendChild(link)
    </script>

    <script src="js/reveal.js"></script>

    <style>
      * {
        box-sizing: border-box;
      }

      body {
        --dark-blue: hsl(202, 69%, 15%);
        --light-blue: #15a9dd;
        --light-orange: hsl(19, 87%, 62%);
        --dark-orange: hsl(24, 100%, 38%);
        --light-red: hsl(0, 94%, 41%);
        --red: #7b0001;
        --shadow: hsl(202, 69%, 15%, 0.4);
        --green: hsl(125, 94%, 41%);
        --dark-green: hsl(125 94% 20%);
        --gradient-start: hsl(259, 71%, 80%);
        --gradient-end: hsl(265, 58%, 50%);
        --yellow: #f2e34b;
      }

      .notes {
        display: none;
      }

      pre,
      .browser {
        -moz-tab-size: 2;
        tab-size: 2;
        border: 4px solid hsl(200, 10%, 55%);
        border-top-width: 32px;
        border-radius: 10px;
        padding: 0.5em;
        background: #272822;
        box-shadow: inset 2px 2px 1px black, 4px 4px 8px hsla(0, 0%, 20%, 0.3);
        align-self: center;
      }

      pre code {
        border-radius: 10px;
        height: 100%;
      }

      h1 {
        font-size: 60px;
      }

      ul {
        list-style-type: "\1F69C";
      }

      li {
        margin: 0.75em 0;
        padding-left: 0.5em;
      }

      .shadow {
        box-shadow: 1px 1px 4px hsla(0, 0%, 70%), 3px 3px 6px hsla(0, 0%, 70%);
      }

      .reveal .slides > section.auto-height {
        height: auto;
      }

      .fragment.transient {
        display: none;
      }

      .fragment.transient.current-fragment {
        display: block;
      }

      section.with-heading {
        grid-template-rows: min-content;
        align-content: center;
        justify-content: center;
        height: 100vh;
      }

      .emoji-image {
        font-size: 10rem;
        align-self: center;
        justify-self: center;
      }
    </style>
  </head>

  <body>
    <div class="reveal">
      <div class="slides">
        <section class="title" data-background-image="images/img_hero.jpg">
          <h1 style="width: 50%; font-size: 3em; margin: 0; text-align: left">
            Getting on the refactor tractor
          </h1>
        </section>

        <section>
          <style>
            .intro {
              display: grid;
              grid-template-columns: 2fr 1fr;
              text-align: left;
              margin: auto;
            }

            .intro a {
              font-weight: bold;
              grid-column: 1 / -1;
              margin-top: 50px;
            }

            .intro .zoidberg {
              border-radius: 62% 38% 63% 37% / 73% 52% 48% 27%;
              grid-column: 2;
              grid-row: 1 / 3;
            }

            .intro img {
              grid-column: 1;
            }
          </style>
          <div class="intro">
            <div style="font-family: Futurama; align-self: end">
              @ErinJZimmer
            </div>
            <img class="zoidberg" src="images/zoidberg-knitting.gif" alt="" />
            <img src="images/Atlassian-horizontal-blue-rgb.svg" alt="" />
            <a href="https://refactor-tractor.ez.codes"
              >https://refactor-tractor.ez.codes</a
            >
          </div>
        </section>

        <!-- <section>
          <div class="inverse" style="display: flex">
            <h4 style="margin: auto">Change implementation, not behaviour</h4>
          </div>
        </section> -->

        <section>
          <div
            style="
              display: flex;
              flex-direction: column;
              justify-content: center;
              align-items: center;
            "
          >
            <h2>Safer refactoring</h2>
            <ul>
              <li class="fragment">Characterisation tests</li>
              <li class="fragment">Snapshot tests</li>
            </ul>
          </div>
        </section>

        <section>
          <div class="inverse" style="display: flex">
            <h4 style="margin: auto">Characterisation tests</h4>
          </div>
          <div class="notes">
            testing what the behaviour of the system _is_, not whether it's
            correct even if you've already got good test coverage, you might
            want to consider adding some because tests usually only cover
            _intended_ behaviour
          </div>
        </section>

        <section>
          <img
            src="images/legacy-code-book.jpg"
            alt="Working effectively with legacy code, by Michael Feathers"
            style="height: 500px"
          />
        </section>

        <section>
          <style>
            .test-types thead {
              border-bottom: 2px solid;
            }

            .test-types tbody td {
              border-bottom: 1px solid;
            }

            .test-types tr td:first-child,
            .test-types tr th:first-child {
              border-right: 1px solid;
            }

            .test-types tfoot {
              border-top: 2px solid;
              font-style: italic;
            }
          </style>
          <table class="test-types">
            <thead>
              <tr>
                <th>Feature test</th>
                <th>Characterisation test</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="fragment" data-fragment-index="1">
                  <ol>
                    <li>Write test with expectations</li>
                  </ol>
                </td>
                <td class="fragment" data-fragment-index="3">
                  <ol>
                    <li>Write test with no expectations</li>
                  </ol>
                </td>
              </tr>
              <tr>
                <td class="fragment" data-fragment-index="2">
                  <ol start="2">
                    <li>Write code to make test pass</li>
                  </ol>
                </td>
                <td class="fragment" data-fragment-index="4">
                  <ol start="2">
                    <li>Change expectations until test passes</li>
                  </ol>
                </td>
              </tr>
            </tbody>
            <tfoot>
              <tr>
                <td class="fragment" data-fragment-index="5">
                  Code changes, test stays the same
                </td>
                <td class="fragment" data-fragment-index="5">
                  Test changes, code stays the same
                </td>
              </tr>
            </tfoot>
          </table>
          <div class="notes">
            Of, if you're not into TDD, write code, write tests, go back and
            change code until tests pass, consider your life choices and how
            much time you would have saved if you'd skipped the first step
          </div>
        </section>

        <section>
          <pre><code>
function formatDate(date) {
  if (!date) return ""

  return moment(new Date(date)).format("yyyy-MM-D")
}
          </code></pre>
          <div class="notes">
            1 for 1 replacement maintain all existing behaviour some risk - can
            take a few different kinds of input also, there's a bug in the code
            that we want to preserve
          </div>
        </section>

        <section>
          <div class="emoji-image">üë©üèΩ‚Äçüíª</div>
          <div class="notes">
            start with momentjs format function tests - undefined - a date - a
            number - a string - a string that isn't a date - a string that's an
            invalid date - the number zero there are other test cases we could
            write (eg passing in a a boolean, cos that's going to behave
            weirdly, but if you're passing booleans into a date formatting
            function something else has gone terribly wrong. also, use
            typescript) switch the library are there any differences? how will
            we deal with them? would i really write all these tests for such a
            small function? - if it was only used once, no, i'd just write the
            likely cases - if it was used everywhere, then, yes
          </div>
        </section>

        <section>
          <div class="inverse">
            <h4 style="font-size: 2em; padding: 0">JSX</h4>
          </div>
        </section>

        <section>
          <pre><code class="jsx">function UserInfo({ user }) {
	const date = formatDate(user.birthday)
	const day = moment(user.birthday).format("dddd")

	return (
		<div>
			{user.name} was born on {date} ({day})
		</div>
	)
}
</code></pre>
          <div class="notes">
            - continuing with our moment to dayjs refactor, we can take the same
            approach as before...
          </div>
        </section>

        <section>
          <div class="emoji-image">üë©üèΩ‚Äçüíª</div>
          <div class="notes">
            write some tests (use "container") do the refactor but also, when
            we're rendering components we have some other tools available to us
          </div>
        </section>

        <section>
          <div class="inverse">
            <h4>Snapshot Tests</h4>
          </div>
        </section>

        <section>
          <div style="display: flex">
            <ol style="margin: auto">
              <li class="fragment">Generate a snapshot</li>
              <li class="fragment">Make changes</li>
              <li class="fragment">Check against the snapshot</li>
            </ol>
          </div>
          <div class="notes">
            snapshot = text rendering of component step 3 = generate a new
            snapshot & do a diff
          </div>
        </section>

        <section>
          <div class="emoji-image">üë©üèΩ‚Äçüíª</div>
          <div class="notes">
            easier just to show - write snapshot test of UserInfo - run test to
            generate snapshot - show where snapshot is created and what it looks
            like - change something in the test show what happens when the
            snapshot fails & how to update it
          </div>
          <div class="notes">
            more complicated example - clicking on a button the increments a
            count
          </div>
        </section>

        <section>
          <div
            style="
              display: flex;
              flex-direction: column;
              justify-content: center;
              align-items: center;
            "
          >
            <h2>Snapshot test gotchas</h2>
            <ul>
              <li class="fragment">async rendering</li>
            </ul>
          </div>
        </section>

        <section>
          <pre style="font-size: 0.5em"><code class="text" style="color: white">
exports[`renders something asynchronously`] = `
&lt;div />
`;
          </code></pre>
        </section>

        <section>
          <div
            style="
              display: flex;
              flex-direction: column;
              justify-content: center;
              align-items: center;
            "
          >
            <h2>Snapshot test gotchas</h2>
            <ul>
              <li>async rendering</li>
              <li class="fragment">not everything is rendered</li>
            </ul>
          </div>
        </section>

        <section>
          <pre style="font-size: 0.5em"><code class="text" style="color: white">
exports[`updates the state of the checkbox`] = `
&lt;div>
  &lt;input
    type="checkbox"
  />
  &lt;/div>
`;
          </code></pre>
        </section>

        <section>
          <div class="inverse">
            <h4 style="font-family: 'Eagle Lake'">ye olde farme shoppe</h4>
          </div>
        </section>

        <section>
          <img src="images/ye-old-farm-shoppe.png" />
        </section>

        <section>
          <div style="margin: auto">
            <h2 style="position: relative">New requirements!</h2>
            <ul>
              <li class="fragment">New product type radio button: plant</li>
              <li class="fragment">
                Show unit + total price for plant in label ($15)
              </li>
              <li class="fragment">Calculate postage for plants</li>
            </ul>
          </div>
          <div class="notes">
            have a look at the code and why we might want to refactor it
          </div>
        </section>

        <section>
          <img src="images/updated-reqs.png" />
        </section>

        <section>
          <div class="emoji-image">üë©üèΩ‚Äçüíª</div>
          <div class="notes">
            - snapshot tests of whole component (inc seeds/seedlings, no amount,
            amount) - refactor to CountInput - code new plants option
          </div>
        </section>

        <section>
          <div style="margin: auto">
            <h2>What did we learn?</h2>
            <ul>
              <li class="fragment">
                Make the change easy, make the easy change
              </li>
              <li class="fragment">Change implementatin, not functionality</li>
              <li class="fragment">Characterisation tests</li>
              <li class="fragment">Snapshot tests</li>
            </ul>
          </div>
        </section>

        <section class="end">
          <style>
            .end {
              font-family: Futurama;
              align-items: center;
            }

            .end .bender {
              position: fixed;
            }
          </style>

          <div class="fragment">
            <a href="https://refactor-tractor.ez.codes"
              >https://refactor-tractor.ez.codes</a
            >
          </div>
          <div class="fragment">
            <a href="https://github.com/ejzimmer/refactor-example"
              >https://github.com/ejzimmer/refactor-example</a
            >
          </div>

          <div class="fragment">
            <div>@ErinJZimmer</div>
          </div>
        </section>
      </div>
    </div>

    <div
      style="
        position: fixed;
        bottom: 30px;
        right: 30px;
        font-family: Futurama;
        font-size: 36px;
        opacity: 0.6;
        z-index: 1;
      "
    >
      @ErinJZimmer
    </div>

    <script>
      // More info about config & dependencies:
      // - https://github.com/hakimel/reveal.js#configuration
      // - https://github.com/hakimel/reveal.js#dependencies
      Reveal.initialize({
        controls: false,
        controlsLayout: "edges",
        history: true,
        display: "grid",
        progress: false,
        transition: "fade",
        center: false,
        dependencies: [
          { src: "plugin/markdown/marked.js" },
          { src: "plugin/markdown/markdown.js" },
          { src: "plugin/notes/notes.js", async: true },
          { src: "plugin/highlight/highlight.js", async: true },
        ],
      })
    </script>
  </body>
</html>
